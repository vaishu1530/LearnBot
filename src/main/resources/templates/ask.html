<!DOCTYPE html>
<html xmlns:th="[http://www.thymeleaf.org](http://www.thymeleaf.org)">
<head>
    <title>LearnBot Pro</title>
    <script type="module">
        import mermaid from '[https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs](https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs)';
        mermaid.initialize({ startOnLoad: false, theme: 'neutral' });
        window.mermaid = mermaid;
    </script>
</head>
<body>
    <div id="response-box">
        <div id="ai-text" style="display:none;" th:text="${botResponse}"></div>
        
        <div id="final-answer"></div> <div id="diagram-area"></div> </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const raw = document.getElementById('ai-text').innerText;
            const textDiv = document.getElementById('final-answer');
            const diagDiv = document.getElementById('diagram-area');

            // Split the AI response using our custom markers
            const parts = raw.split("[DIAGRAM_START]");
            const textPart = parts[0];
            const diagramPart = parts[1] ? parts[1].split("[DIAGRAM_END]")[0].trim() : null;

            // 1. Show Text
            textDiv.innerHTML = textPart.replace(/\n/g, "<br>");

            // 2. Render Diagram if exists
            if (diagramPart && window.mermaid) {
                const graphDiv = document.createElement('div');
                graphDiv.className = 'mermaid';
                graphDiv.innerHTML = diagramPart;
                diagDiv.appendChild(graphDiv);
                
                await window.mermaid.run({ nodes: [graphDiv] });
            }
        });
    </script>
</body>
</html>